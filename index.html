<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plank Timer</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #000;
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    .timer {
      font-size: 20vh;
      font-weight: 300;
      line-height: 1.1;
      transform: scaleY(1.2); /* вытягиваем по вертикали */
      margin-bottom: 20px;
    }

    .btn {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: none;
      font-size: 22px;
      font-weight: 600;
      color: #fff;
      cursor: pointer;
    }

    .start { background: #007bff; }
    .stop { background: #dc3545; }
    .again { background: #20c997; }

    #exportBtn {
      position: absolute;
      top: 15px;
      right: 15px;
      padding: 8px 16px;
      border-radius: 20px;
      border: 1px solid #fff;
      background: transparent;
      color: #fff;
      cursor: pointer;
    }

    #feedback {
      position: absolute;
      bottom: 20%;
      background: rgba(0,0,0,0.9);
      padding: 20px;
      border-radius: 12px;
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    #feedback h3 { margin: 0 0 10px; }

    .fbtn {
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      border: none;
    }

    .easy { background: #28a745; color: #fff; }
    .normal { background: #6c757d; color: #fff; }
    .hard { background: #dc3545; color: #fff; }

  </style>
</head>
<body>
  <div class="app">
    <div id="timer" class="timer">20</div>
    <button id="actionBtn" class="btn start">Start</button>
    <button id="exportBtn">Export CSV</button>

    <div id="feedback">
      <h3>Как ощущалось упражнение?</h3>
      <div>
        <button class="fbtn easy" onclick="saveFeedback('easy')">Легко</button>
        <button class="fbtn normal" onclick="saveFeedback('normal')">Нормально</button>
        <button class="fbtn hard" onclick="saveFeedback('hard')">Сложно</button>
      </div>
    </div>
  </div>

  <script>
    let duration = 20;
    let timerEl = document.getElementById('timer');
    let actionBtn = document.getElementById('actionBtn');
    let exportBtn = document.getElementById('exportBtn');
    let feedbackBox = document.getElementById('feedback');
    let interval;
    let history = JSON.parse(localStorage.getItem('plankHistory')) || [];

    function startTimer() {
      let timeLeft = duration;
      timerEl.textContent = timeLeft;
      actionBtn.textContent = "Stop";
      actionBtn.className = "btn stop";
      exportBtn.style.display = "none";

      interval = setInterval(() => {
        timeLeft--;
        timerEl.textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(interval);
          showFeedback();
        }
      }, 1000);
    }

    function stopTimer() {
      clearInterval(interval);
      showFeedback();
    }

    function showFeedback() {
      timerEl.style.display = "none"; // скрываем ноль
      actionBtn.textContent = "Again";
      actionBtn.className = "btn again";
      exportBtn.style.display = "block";
      feedbackBox.style.display = "flex";
    }

    function saveFeedback(feel) {
      let now = new Date().toISOString().split("T")[0];
      history.push({ date: now, duration, feel });
      localStorage.setItem('plankHistory', JSON.stringify(history));

      // Алгоритм корректировки
      if (feel === "easy") duration = Math.min(300, Math.round(duration * 1.05));
      if (feel === "hard") duration = Math.max(10, Math.round(duration * 0.95));

      // Сброс на новый цикл
      feedbackBox.style.display = "none";
      timerEl.style.display = "block";
      timerEl.textContent = duration;
      actionBtn.textContent = "Start";
      actionBtn.className = "btn start";
    }

    actionBtn.addEventListener("click", () => {
      if (actionBtn.textContent === "Start") startTimer();
      else if (actionBtn.textContent === "Stop") stopTimer();
      else if (actionBtn.textContent === "Again") {
        timerEl.textContent = duration;
        actionBtn.textContent = "Start";
        actionBtn.className = "btn start";
      }
    });

    exportBtn.addEventListener("click", () => {
      if (history.length === 0) {
        alert("История пуста!");
        return;
      }
      let csv = "Дата,Время,Ощущение\n" + history.map(h => `${h.date},${h.duration},${h.feel}`).join("\n");
      let blob = new Blob([csv], { type: "text/csv" });
      let url = URL.createObjectURL(blob);
      let a = document.createElement("a");
      a.href = url;
      a.download = "plank_history.csv";
      a.click();
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
